using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using AwfulRedux.Mobile.Services;
using AwfulRedux.Mobile.Tools;
using AwfulRedux.Mobile.Views;
using AwfulRedux.UI.Models.Forums;
using Newtonsoft.Json;
using Xamarin.Forms;
using Category = AwfulRedux.Mobile.Models.Category;

namespace AwfulRedux.Mobile.ViewModel
{
    public class MainForumsPageViewModel : ViewModelBase
    {
        private string _sample = "[{\"Name\":\" Main\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=48\",\"Id\":48,\"Order\":1,\"ForumList\":[{\"Name\":\"General Bullshit 2: On The Move\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=1\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":1,\"Id\":0,\"ForumCategoryEntityId\":48,\"ParentForumId\":0},{\"Name\":\"SA\'s Front Page Discussion\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=155\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":155,\"Id\":0,\"ForumCategoryEntityId\":48,\"ParentForumId\":1},{\"Name\":\"E/N Bullshit\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=214\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":214,\"Id\":0,\"ForumCategoryEntityId\":48,\"ParentForumId\":1},{\"Name\":\"FYAD: Han Solo Dies\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=26\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":26,\"Id\":0,\"ForumCategoryEntityId\":48,\"ParentForumId\":0},{\"Name\":\"FYAD Dump\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=154\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":154,\"Id\":0,\"ForumCategoryEntityId\":48,\"ParentForumId\":26},{\"Name\":\"BYOB: The Good, Clean, Funnies List\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=268\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":268,\"Id\":0,\"ForumCategoryEntityId\":48,\"ParentForumId\":0},{\"Name\":\"Cool Crew Chat Central\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=196\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":196,\"Id\":0,\"ForumCategoryEntityId\":48,\"ParentForumId\":268},{\"Name\":\"RSF: Election Erection\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=269\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":269,\"Id\":0,\"ForumCategoryEntityId\":48,\"ParentForumId\":0}]},{\"Name\":\" Discussion\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=51\",\"Id\":51,\"Order\":2,\"ForumList\":[{\"Name\":\"Games\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=44\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":44,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"A Blizzard Subforum\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=259\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":259,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":44},{\"Name\":\"WoW: Goon Squad\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=146\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":146,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":44},{\"Name\":\"The MMO HMO\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=145\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":145,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":44},{\"Name\":\"Private Game Servers\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=93\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":93,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":44},{\"Name\":\"Traditional Games\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=234\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":234,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":44},{\"Name\":\"The Game Room\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=103\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":103,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":44},{\"Name\":\"Let\'s Play!\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=191\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":191,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":44},{\"Name\":\"The Imp Zone\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=267\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":267,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":44},{\"Name\":\"Inspect Your Gadgets\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=192\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":192,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"Ask / Tell\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=158\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":158,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"Science, Academics and Languages\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=162\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":162,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":158},{\"Name\":\"Tourism & Travel\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=211\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":211,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":158},{\"Name\":\"Business, Finance, and Careers\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=200\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":200,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":158},{\"Name\":\"Debate & Discussion: The Problem Attic\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=46\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":46,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"Serious Hardware / Software Crap\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=22\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":22,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"Haus of Tech Support\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=170\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":170,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":22},{\"Name\":\"The Cavern of COBOL\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=202\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":202,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":22},{\"Name\":\"project.log\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=265\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":265,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":22},{\"Name\":\"YOSPOS\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=219\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":219,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":22},{\"Name\":\"Sports Argument Stadium\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=122\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":122,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"The Football Funhouse\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=181\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":181,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":122},{\"Name\":\"The Armchair Quarterback\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=248\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":248,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":122},{\"Name\":\"The Michu Picchu\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=175\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":175,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":122},{\"Name\":\"Rowdy Ringsports\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=177\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":177,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":122},{\"Name\":\"You Look Like Shit\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=179\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":179,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"The Goon Doctor\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=183\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":183,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":179},{\"Name\":\"The Fitness Log Cabin\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=244\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":244,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":179},{\"Name\":\"Something Offal\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=161\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":161,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"Post Your Favorite (or Request)\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=167\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":167,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"Automotive Insanity\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=91\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":91,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"Cycle Asylum\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=236\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":236,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":91},{\"Name\":\"Heavy Petting\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=124\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":124,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"The Firing Range\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=132\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":132,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"Dope Threads\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=90\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":90,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0},{\"Name\":\"The Ghoulish, Conspiracy Mongering Forum\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=218\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":218,\"Id\":0,\"ForumCategoryEntityId\":51,\"ParentForumId\":0}]},{\"Name\":\" The Finer Arts\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=152\",\"Id\":152,\"Order\":3,\"ForumList\":[{\"Name\":\"Creative Convention\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=31\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":31,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0},{\"Name\":\"DIY & Hobbies\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=210\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":210,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":31},{\"Name\":\"The Dorkroom\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=247\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":247,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":31},{\"Name\":\"Cinema Discusso\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=151\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":151,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0},{\"Name\":\"The Film Dump\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=133\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":133,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":151},{\"Name\":\"The Book Barn\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=182\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":182,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0},{\"Name\":\"No Music Discussion\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=150\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":150,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0},{\"Name\":\"Musician\'s Lounge\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=104\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":104,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":150},{\"Name\":\"The TV IV\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=130\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":130,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0},{\"Name\":\"Batman\'s Shameful Secret\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=144\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":144,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0},{\"Name\":\"VEGETA\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=27\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":27,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0},{\"Name\":\"Entertainment, Weakly\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=215\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":215,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0},{\"Name\":\"Rapidly Going Deaf\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=255\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":255,\"Id\":0,\"ForumCategoryEntityId\":152,\"ParentForumId\":0}]},{\"Name\":\" The Community\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=153\",\"Id\":153,\"Order\":4,\"ForumList\":[{\"Name\":\"SAMart\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=61\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":61,\"Id\":0,\"ForumCategoryEntityId\":153,\"ParentForumId\":0},{\"Name\":\"Feedback & Discussion\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=77\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":77,\"Id\":0,\"ForumCategoryEntityId\":153,\"ParentForumId\":61},{\"Name\":\"Coupons & Deals\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=85\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":85,\"Id\":0,\"ForumCategoryEntityId\":153,\"ParentForumId\":61},{\"Name\":\"Goon Meets\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=43\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":43,\"Id\":0,\"ForumCategoryEntityId\":153,\"ParentForumId\":0},{\"Name\":\"LAN: Your City Sucks  Regional Discussion\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=241\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":241,\"Id\":0,\"ForumCategoryEntityId\":153,\"ParentForumId\":0},{\"Name\":\"Questions, Comments, Spoilers?  Read the stickies first!\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=188\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":188,\"Id\":0,\"ForumCategoryEntityId\":153,\"ParentForumId\":0},{\"Name\":\"Apps In Developmental States\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=261\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":261,\"Id\":0,\"ForumCategoryEntityId\":0,\"ParentForumId\":0}]},{\"Name\":\" Archives\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=49\",\"Id\":49,\"Order\":5,\"ForumList\":[{\"Name\":\"Comedy Goldmine\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=21\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":21,\"Id\":0,\"ForumCategoryEntityId\":49,\"ParentForumId\":0},{\"Name\":\"Comedy Purgatory\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=264\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":264,\"Id\":0,\"ForumCategoryEntityId\":49,\"ParentForumId\":21},{\"Name\":\"FYAD: Criterion Collection\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=115\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":115,\"Id\":0,\"ForumCategoryEntityId\":49,\"ParentForumId\":21},{\"Name\":\"BYOB Goldmine\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=176\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":176,\"Id\":0,\"ForumCategoryEntityId\":49,\"ParentForumId\":21},{\"Name\":\"YCS Goldmine\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=229\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":true,\"TotalPages\":0,\"ForumId\":229,\"Id\":0,\"ForumCategoryEntityId\":49,\"ParentForumId\":21},{\"Name\":\"Comedy Gas Chamber\",\"Location\":\"http://forums.somethingawful.com/forumdisplay.php?forumid=25\",\"Description\":null,\"CurrentPage\":0,\"IsSubforum\":false,\"TotalPages\":0,\"ForumId\":25,\"Id\":0,\"ForumCategoryEntityId\":49,\"ParentForumId\":0}]}]";

        private OfflineDataStore _offlineDataStore = new OfflineDataStore();
        private ObservableCollection<Category> _forumCategories = new ObservableCollection<Category>();

        public ObservableCollection<Category> ForumCategories
        {
            get { return _forumCategories; }
            set
            {
                SetProperty(ref _forumCategories, value);
                OnPropertyChanged();
            }
        }

        public Action<Forum> ItemSelected { get; set; }

        private Forum _selectedForum;

        public Forum SelectedForum
        {
            get { return _selectedForum; }
            set
            {
                _selectedForum = value;
                OnPropertyChanged("SelectedForum");
                if (SelectedForum == null)
                    return;
                if (ItemSelected == null)
                {
                    page.Navigation.PushAsync(new ForumListPage(_selectedForum));
                    SelectedForum = null;
                }
                else
                {
                    ItemSelected.Invoke(_selectedForum);
                }
            }
        }

        public async Task Initialize()
        {
            var forums = await _offlineDataStore.GetDefaultForumList();
            foreach (var forum in forums)
            {
                var cat = new Category()
                {
                    Location = forum.Location,
                    Name = forum.Name,
                    Order = forum.Order
                };
                foreach (var item in forum.ForumList)
                {
                    cat.Add(item);
                }
                ForumCategories.Add(cat);
            }
        }

        public MainForumsPageViewModel(Page page) : base(page)
        {
            Title = "Main Forums";
        }
    }
}
